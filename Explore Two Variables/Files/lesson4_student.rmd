Lesson 4
========================================================

***

### Scatterplots and Perceived Audience Size
Notes: After plotting histograms and looking at peoples guesses, we wanted to see how it matched with their actual order size.

**They then turned to scatter plots**.

[Moira's Investigation from Lesson 3](https://classroom.udacity.com/courses/ud651/lessons/755618712/concepts/8140986010923)
[Bernstein, M. S., Bakshy, E., Burke, M., & Karrer, B. (2013). Quantifying the invisible audience in social networks. In Proceedings of the SIGCHI Conference on Human Factors in Computing Systems (CHI 2013), pp. 21-30.](http://hci.stanford.edu/publications/2013/invisibleaudience/invisibleaudience.pdf)
***

### Scatterplots
Notes: We've looked at distributions of single variables and their splitting factors. We will now look at 2 continuous variables at the same time.

**Scatterplot is best to examine the relationship between 2 continuous variables.**

There is not a user interface (UI) feature on Facebook's website that causes people to pick the particular age of 69 or the older ages. In general, it is a good idea to think about what caused certain oddities or values in data sets. This can help explain dirty data.

```{r Scatterplots}
setwd("~/Desktop/Nanodegrees/Data Analyst/Task 4/Data Analysis with R/Explore Two Variables/Files/")
list.files()

library(ggplot2)

pf <- read.csv('pseudo_facebook.tsv', sep='\t')
# You can also read in the data using the following code: 
#read.delim('pseudo_facebook.tsv') 

# These 2 plots are the same. qplot knows x comes first, y comes second.
qplot(x=age, y=friend_count, data = pf)
#qplot(age, friend_count, data = pf)

# The equivalent ggplot syntax for the scatterplot: 
#ggplot(aes(x = age, y = friend_count), data = pf) + 
  #geom_point()


```

***

#### What are some things that you notice right away?
Response: There are lots of data points below the age of 30 with high friend_count, this then decreases normally and peaks again around 70, and again after 90 which is odd.

It looks like younger users have a lot of friends (more than users over the ages of 30). There are some vertical lines in their 70s and 90s which are likely to be fake accounts or teens who have lied about their ages.

***

### ggplot Syntax
Notes: Start by switching to ggplot syntax (more formal and verbose). **ggplot lets us specify more complicated plots.**

**Add 1 layer at a time when building up plots**. This allows you to debug and find broken code.

[ggplot2 geoms](http://docs.ggplot2.org/current/)
[ggplot2 tutorial by Ramon Saccilotto](http://bbs.ceb-institute.org/wp-content/uploads/2011/09/handout_ggplot2.pdf)

```{r ggplot Syntax}
qplot(x=age, y=friend_count, data = pf)

# have to wrap x and y variables in aesthetic wrapper.
ggplot(aes(x=age, y=friend_count), data = pf) + geom_point() +
  xlim(13,90)

# Find min and max limits.
summary(pf$age)

```

***

### Overplotting
Notes: Notice, some of these points are spread out from one another and some are over each other. 

When the points are over each other, it's considered to be **overplotted**. This makes it difficult to tell how many points are in each region. 

We can set the transparency of the points using the **alpha parametr in geom_point**.

After doing that, we can see the bulk of the data lies below the 1000 threshold for friend_count.

**geom_jitter** adds some noise so we get a clearer picture of the relationship between age and friend_count (as age is continuous and not an integer)

```{r Overplotting}
# Setting the alpha parameter. 1/20 means it will take 20 points to be the equivalent of 1 black dot.
ggplot(aes(x=age, y=friend_count), data = pf) +
  geom_jitter(alpha = 1/20) +
  xlim(13,90)
```

#### What do you notice in the plot?
Response: There are a lot of people with friends below 500 in all ages. Below the ages of 25, there are still quite a few people who have friend counts greater than 1000. At around 70, there is an uncharacteristic peak which is likely caused by false account ages.

We can see the friend counts for young users isn't as high as previously thought. There is a peak around 69 and it's fake as it's comparable to users around the 25.26 age group.

***

### Coord_trans()
Notes: We're gonna use a transformation on the y axis so we change the friend_count. We do this to get a better visualisation of the data.

Look up the documentation for [coord_trans](http://docs.ggplot2.org/current/coord_trans.html).


```{r Coord_trans()}
# Looking up coord_trans
?coord_trans
```

#### Look up the documentation for coord_trans() and add a layer to the plot that transforms friend_count using the square root function. Create your plot!

```{r Coord_trans Solution}
# Back to geom_point. If we wanted to add jitter, we'd need more elaborate syntax. Adding noise to 0 creates -ve numbers, which would have imaginary square roots. Fix this by putting position parameter in.
ggplot(aes(x = age, y = friend_count), data = pf) +
  #geom_point(alpha = 1/20) +
  geom_point(alpha = 1/20,  position = position_jitter(h = 0)) +
  xlim(13,90) +
  coord_trans(y = 'sqrt')
```

#### What do you notice?
The friend_count scale changed. It's easier to see the distribution of friend count conditional on age.

Thresholds have friend_count above which there are very few users. 

***

### Alpha and Jitter
Notes: Using knowledge of **alpha** and **jitter**, examine the relationship between friendships_initiated (y) and age (x) using the ggplot syntax.

We recommend building the plot in layers using the **ggplot** syntax, creating a basic scatter plot first to see what the distribution looks like and then adjusting it by adding one layer at a time. 


```{r Alpha and Jitter}
names(pf)

ggplot(aes(x = age, y = friendships_initiated), data = pf) +
  geom_point(alpha = 1/10, position = position_jitter(h = 0)) +
  xlim(13,90) +
  coord_trans(y = 'sqrt')

```

#### What are your observations about your final plot?
People under the age of 30 have a lot of initite a lot more friendships (around 500 more) than people over 30. There is a peak around 69 again which is similar to the peaks around 22-26 and this means it seem fake.

***

### Overplotting and Domain Knowledge
Notes: Moira than took the perceived audience and actual audience, but this time transformed the axis so that it was a % of their friend_count. The plot then showed that most of the points were well below their actual.

***

### Conditional Means
Notes: Sometimes we want to understand how the mean or median of a variable varies with another varaible. That is, it can be helpful to summarise relationships of 2 in other ways, rather than plotting every time.

**dplyr** package lets us split up the data, and apply a function to some parts of the data.

Another warning: Version 0.4.0 of **dplyr** has a bug when using the median function on the summarize layer, depending on the nature of the data being summarized. You may need to cast the data as a numeric (float) type when using it on your local machine, e.g. median(as.numeric(var)).

Learn more about the [dplyr package](https://blog.rstudio.org/2014/01/17/introducing-dplyr/). 

[Introduction to dplyr](http://rstudio-pubs-static.s3.amazonaws.com/11068_8bc42d6df61341b2bed45e9a9a3bf9f4.html) (knitted html file)

The following tutorials are presented by Hadley Wickham at useR 2014:

* [Introduction of dplyr](https://www.r-bloggers.com/hadley-wickham-presents-dplyr-at-user-2014/)
* [dplyr Tutorial Part 1](https://www.r-bloggers.com/hadley-wickhams-dplyr-tutorial-at-user-2014-part-1/)
* [dplyr Tutorial Part 2](https://www.r-bloggers.com/hadley-wickhams-dplyr-tutorial-at-user-2014-part-2/)

There are other ways to work with data and create new data frames without using the dplyr package. Learn about the R functions **lapply**, **tapply**, and **split** in a [blog post](https://rollingyours.wordpress.com/2014/10/20/the-lapply-command-101/).


```{r Conditional Means}
# Package needed to create the table.
# install.packages('dplyr')
library(dplyr)

# Group dataframe by age. We need to pass in a datafrmae/grouping and then save it into a new variable which is passed into the next function.
age_groups <- group_by(pf, age)

# N function can only be in function and it reports how many people are in each group
pf.fc_by_age <- summarise(age_groups, 
          friend_count_mean = mean(friend_count),
          friend_count_median = median(friend_count),
          n = n())

# Arrange by age
pf.fc_by_age <- arrange(pf.fc_by_age)

head(pf.fc_by_age)
```

#### Conditional Means Alternate Code

```{r Conditional Means Alternate Code}
library(dplyr)

# Take dataset and apply function using %>% which allows you to chain functions onto the dataset.
pf.fc_by_age <- pf %>% 
  group_by(age) %>%
  summarise(friend_count_mean = mean(friend_count),
            friend_count_median = median(friend_count),
            n = n()) %>%
  arrange(age)

head(pf.fc_by_age, 20)
```

From the tables above, you can already see that users aged 14-23 have have friend count means and medians that other users. The mean friend_count peaks around 16-17.

#### Create your plot!

Plot mean friend count vs. age using a line graph. Be sure you use the correct variable names and the correct data frame. 

You should be working with the new data frame created from the **dplyr** functions. The data frame is called **'pf.fc_by_age'**.

Use **geom_line()** rather than **geom_point** to create the plot. You can look up the documentation for [geom_line() documentation here](http://docs.ggplot2.org/current/geom_path.html) to see what it does.

```{r Conditional Means Plot}
names(pf.fc_by_age)

ggplot(aes(x = age, y = friend_count_mean),
       data = pf.fc_by_age) + 
  geom_line()
```

***

### Overlaying Summaries with Raw Data
Notes: **ggplot** allows us to easily create various summaries of our data and plot them. This is useful for quick exploration and for combining plots of raw data like our original scatter plot with displayed summaries.

We can help ourselves understand this conditional distribution of friend_counts by also plotting quantiles of the data. 

Note: ggplot 2.0.0 changes the syntax for parameter arguments to functions when using **stat = 'summary'**. To denote parameters that are being set on the function specified by **fun.y**, use the **fun.args** argument, e.g.:
**geom_line(stat = 'summary', fun.y = quantile,          fun.args = list(probs = .9), ... )**

To zoom in, the code should use the **coord_cartesian(xlim = c(13, 90))** layer rather than **xlim(13, 90)** layer.

Try an example and practice problem for calculating [quantiles (percentiles)](http://www.r-tutor.com/elementary-statistics/numerical-measures/percentile).

```{r Overlaying Summaries with Raw Data}
# Plotting Scatter plot with line plot overlayed. Fun.y takes any type of function so we can apply it to the y value.
# Need to set the probability to whatever you want, e.g. could be .5 for 50%, .78 for 78%.
ggplot(aes(x = age, y = friend_count), data = pf) + 
  coord_cartesian(xlim = c(13,70), ylim = c(0,1000)) +
  geom_point(alpha = 0.05,
             position = position_jitter(h = 0),
             color = 'orange') +
  geom_line(stat = 'summary', fun.y = mean) +
  geom_line(stat = 'summary', fun.y = quantile, fun.args = list(probs = .1),
            linetype = 2, color = 'blue') +
  geom_line(stat = 'summary', fun.y = quantile, fun.args = list(probs = .5),
            color = 'blue') +
  geom_line(stat = 'summary', fun.y = quantile, fun.args = list(probs = .9),
            linetype = 2, color = 'blue') 
```

#### What are some of your observations of the plot?
Response: The 90th quantile is less than 1000 for all ages. The 50th quantile is less than the mean. 

For 35 year olds to 60 year olds, the friend count falls below 250. So according to our data, 90% of people in this age group have less than 250 friends.

***

### Moira: Histogram Summary and Scatterplot
See Moira's paper on perceived audience size as well as her final plot and how she aligned the histograms with the scatterplots in the published paper.
[Bernstein, M. S., Bakshy, E., Burke, M., & Karrer, B. (2013). Quantifying the invisible audience in social networks. In Proceedings of the SIGCHI Conference on Human Factors in Computing Systems (CHI 2013), pp. 21-30.](http://hci.stanford.edu/publications/2013/invisibleaudience/invisibleaudience.pdf)

***

### Correlation
Notes: It might be appealing to further summarise the relationship between age and friend count. Rather than having the 4 extra layers of **geom_line**, we could try to summarise the strength of this relationship with a single number. 

A **correlation coefficient** or **Pearson's R**, summaries the strength of a relationship with a single number. 

* Pearsons score of >= 0.3 is meaningful but small.
* Pearsons score of >= 0.5 is moderate.
* Pearsons score of >= 0.7 large.

Correlation coefficients are often denoted with the greek letter rho, in addition to the letter r.

The default method for computing the correlation coefficient is Pearson, and this is true for most statistical software. You do not need to pass the method parameter when calculating the Pearson Product Moment Correlation. 

* [A Visual Guide to Correlation](https://s3.amazonaws.com/udacity-hosted-downloads/ud651/correlation_images.jpeg)
* [Correlation Coefficient](http://www.r-tutor.com/elementary-statistics/numerical-measures/correlation-coefficient)
* [Intro to Inferential Statistics- Correlation](https://classroom.udacity.com/courses/ud201/lessons/1345848540/concepts/1715827370923)

**With** function allows us to evaluate an R expression in an environment constructed from the data.

#### Look up the documentation for the cor.test function.

```{r Correlation}
?cor.test
# Computes Pearson Score
cor.test(pf$age, pf$friend_count, method = 'pearson')

# Alternative way to computer Pearsons Score. 
with(pf, cor.test(age, friend_count, method='pearson'))
```

#### What's the correlation between age and friend count? Round to three decimal places.
Response: -0.0274

***

### Correlation on Subsets
Notes: From the correlation exercise previously, we found that the relationship between age and friend count is not linear. It's not monotonic (increasing or decreasing).

Based on the plot, we may not want to include the older ages in our correlation number as older ages are likely to be incorrect.

What are [monotonic functions](http://en.wikipedia.org/wiki/Monotonic_function)? 

Definition of **ostensibly** - apparently or purportedly, but perhaps not actually.

Use the **subset** command or bracket notation for this exercise. 

```{r Correlation on Subsets}
with(subset(pf, age <= 70), cor.test(age, friend_count))
```

**Remember**: it's important to note that one variable doesn't cause the other. We'd need data from experimental research and make use of inferential statistics rather than descriptive statistics to address causality.

***

### Correlation Methods
Notes: **The Pearson product-moment correlation measures the strength of relationship between any 2 variables.**

**We also have measures of monotonic (either increasing or decreasing) relationships such as a rank correlation measures like Spearman.**

[Correlation Methods: Pearson's r, Spearman's rho, and Kendall's tau](http://www.statisticssolutions.com/correlation-pearson-kendall-spearman/)

```{r Correlation Methods}
with(subset(pf, age <= 70), cor.test(age, friend_count, method = 'spearman'))
```

***

## Create Scatterplots
Notes:

```{r}

```

***

### Strong Correlations
Notes:

```{r Strong Correlations}

```

What's the correlation betwen the two variables? Include the top 5% of values for the variable in the calculation and round to 3 decimal places.

```{r Correlation Calcuation}

```

Response:

***

### Moira on Correlation
Notes:

***

### More Caution with Correlation
Notes:

```{r More Caution With Correlation}
install.packages('alr3')
library(alr3)
```

Create your plot!

```{r Temp vs Month}

```

***

### Noisy Scatterplots
a. Take a guess for the correlation coefficient for the scatterplot.

b. What is the actual correlation of the two variables?
(Round to the thousandths place)

```{r Noisy Scatterplots}

```

***

### Making Sense of Data
Notes:

```{r Making Sense of Data}

```

***

### A New Perspective

What do you notice?
Response:

Watch the solution video and check out the Instructor Notes!
Notes:

***

### Understanding Noise: Age to Age Months
Notes:

```{r Understanding Noise: Age to Age Months}

```

***

### Age with Months Means

```{r Age with Months Means}

```

Programming Assignment
```{r Programming Assignment}

```

***

### Noise in Conditional Means

```{r Noise in Conditional Means}

```

***

### Smoothing Conditional Means
Notes:

```{r Smoothing Conditional Means}

```

***

### Which Plot to Choose?
Notes:

***

### Analyzing Two Variables
Reflection:

***

Click **KnitHTML** to see all of your hard work and to have an html
page of this lesson, your answers, and your notes!

